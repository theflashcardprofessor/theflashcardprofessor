<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Cube Professor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #f8f9fa;
            --bg-secondary: white;
            --bg-tertiary: #f8f9fa;
            --text-primary: #2c3e50;
            --text-secondary: #6c757d;
            --border-color: #e9ecef;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.04);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
            --shadow-lg: 0 10px 40px rgba(0,0,0,0.15);
        }

        body.dark-mode {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #1f2937;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --border-color: #30363d;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.4);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.5);
            --shadow-lg: 0 10px 40px rgba(0,0,0,0.6);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            color: var(--text-primary);
            transition: background 0.3s ease, color 0.3s ease;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--bg-secondary);
            min-height: 100vh;
            box-shadow: 0 0 40px rgba(0,0,0,0.08);
            transition: background 0.3s ease;
        }

        .header {
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            color: white;
            padding: 32px 40px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            border-radius: 0 0 24px 24px;
        }

        body.dark-mode .header {
            background: linear-gradient(135deg, #1f2937 0%, #374151 50%, #4b5563 100%);
            box-shadow: 0 2px 20px rgba(0,0,0,0.3);
        }

        .header h1 {
            font-size: 2em;
            font-weight: 600;
            margin-bottom: 20px;
            color: white;
            letter-spacing: -0.5px;
        }

        .nav {
            display: flex;
            justify-content: flex-start;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 24px;
        }

        .nav button {
            background: rgba(255,255,255,0.15);
            border: none;
            color: rgba(255,255,255,0.9);
            padding: 12px 24px;
            cursor: pointer;
            font-size: 0.95em;
            transition: all 0.3s ease;
            border-radius: 20px;
            font-weight: 500;
            backdrop-filter: blur(10px);
        }

        .nav button:hover {
            background: rgba(255,255,255,0.25);
            transform: translateY(-2px);
        }

        .nav button.active {
            background: white;
            color: #0f2027;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .content {
            padding: 40px;
            min-height: 500px;
        }

        .view {
            display: none;
        }

        .view.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .view h2 {
            font-size: 1.8em;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 24px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border-color);
        }

        /* Folder Structure */
        .folder-tree {
            border: 1px solid var(--border-color);
            background: var(--bg-tertiary);
            padding: 20px;
            border-radius: 20px;
        }

        .folder-item {
            padding: 14px 18px;
            margin: 6px 0;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95em;
            border-radius: 16px;
            position: relative;
            box-shadow: var(--shadow-sm);
        }

        .folder-item:hover {
            background: var(--bg-tertiary);
            transform: translateX(4px);
            box-shadow: var(--shadow-md);
        }

        body.dark-mode .folder-item:hover {
            background: #1f2937;
        }

        .folder-item.selected {
            background: linear-gradient(135deg, #0f202715 0%, #2c536415 100%);
            border-color: #2c5364;
        }

        body.dark-mode .folder-item.selected {
            background: linear-gradient(135deg, #37415120 0%, #4b556330 100%);
            border-color: #4b5563;
        }

        .folder-item-content {
            flex: 1;
        }

        .folder-item-color {
            width: 24px;
            height: 24px;
            border-radius: 12px;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
        }

        .folder-item-actions {
            display: none;
            gap: 6px;
        }

        .folder-item:hover .folder-item-actions {
            display: flex;
        }

        .icon-btn {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            padding: 6px 14px;
            cursor: pointer;
            font-size: 0.85em;
            border-radius: 12px;
            transition: all 0.2s ease;
            font-weight: 500;
            color: var(--text-primary);
        }

        .icon-btn:hover {
            background: var(--border-color);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .icon-btn.delete {
            color: #e74c3c;
            border-color: #fadbd8;
        }

        .icon-btn.delete:hover {
            background: #fee;
            border-color: #e74c3c;
        }

        .folder-indent {
            margin-left: 30px;
        }

        .folder-icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 8px;
        }

        .folder-icon::before {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%236c757d' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z'%3E%3C/path%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
        }

        .subfolder-icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 8px;
        }

        .subfolder-icon::before {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%236c757d' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z'%3E%3C/path%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
        }

        .deck-icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 8px;
        }

        .deck-icon::before {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%236c757d' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z'%3E%3C/path%3E%3Cpath d='M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z'%3E%3C/path%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
        }

        /* Buttons */
        .btn {
            background: linear-gradient(135deg, #0f2027 0%, #2c5364 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            cursor: pointer;
            font-size: 0.95em;
            transition: all 0.3s ease;
            margin: 5px;
            border-radius: 10px;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(15, 32, 39, 0.3);
        }

        body.dark-mode .btn {
            background: linear-gradient(135deg, #374151 0%, #4b5563 100%);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(15, 32, 39, 0.4);
        }

        body.dark-mode .btn:hover {
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: white;
            color: #6c757d;
            border: 2px solid #e9ecef;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        body.dark-mode .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: #f8f9fa;
            border-color: #dee2e6;
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }

        body.dark-mode .btn-secondary:hover {
            background: #374151;
            border-color: #4b5563;
        }

        .btn-success {
            background: linear-gradient(135deg, #06d6a0 0%, #1b998b 100%);
            box-shadow: 0 4px 12px rgba(6, 214, 160, 0.3);
        }

        .btn-success:hover {
            box-shadow: 0 6px 20px rgba(6, 214, 160, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef476f 0%, #e74c3c 100%);
            box-shadow: 0 4px 12px rgba(239, 71, 111, 0.3);
        }

        .btn-danger:hover {
            box-shadow: 0 6px 20px rgba(239, 71, 111, 0.4);
        }

        .btn-small {
            padding: 6px 14px;
            font-size: 0.85em;
        }

        /* Flashcard */
        .flashcard-container {
            perspective: 1000px;
            max-width: 700px;
            margin: 30px auto;
        }

        .flashcard {
            width: 100%;
            height: 400px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
        }

        .flashcard.flipped {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 50px;
            border: none;
            background: var(--bg-secondary);
            font-size: 1.4em;
            text-align: center;
            border-radius: 24px;
            box-shadow: var(--shadow-lg);
            line-height: 1.6;
        }

        .card-front {
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            color: white;
        }

        .card-back {
            background: linear-gradient(135deg, #134e5e 0%, #71b280 100%);
            color: white;
            transform: rotateY(180deg);
        }

        body.dark-mode .card-front {
            background: linear-gradient(135deg, #1f2937 0%, #374151 50%, #4b5563 100%);
            border: 1px solid #30363d;
        }

        body.dark-mode .card-back {
            background: linear-gradient(135deg, #065f46 0%, #059669 100%);
            border: 1px solid #30363d;
        }

        .card-counter {
            text-align: center;
            margin: 20px 0;
            font-size: 0.95em;
            color: #6c757d;
            font-weight: 500;
        }

        .card-controls {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 30px;
        }

        /* Forms */
        .form-group {
            margin: 20px 0;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #495057;
            font-size: 0.95em;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            font-size: 0.95em;
            transition: all 0.3s ease;
            border-radius: 16px;
            font-family: inherit;
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: #2c5364;
            box-shadow: 0 0 0 3px rgba(44, 83, 100, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 120px;
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #0f2027 0%, #2c5364 100%);
            color: white;
            padding: 32px;
            text-align: center;
            border-radius: 24px;
            box-shadow: 0 10px 30px rgba(15, 32, 39, 0.3);
            transition: transform 0.3s ease;
        }

        body.dark-mode .stat-card {
            background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
            border: 1px solid #30363d;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 3em;
            font-weight: 700;
            margin: 12px 0;
            color: white;
        }

        .stat-label {
            font-size: 1em;
            color: rgba(255,255,255,0.9);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 0.85em;
        }

        /* Settings */
        .settings-section {
            background: var(--bg-tertiary);
            padding: 24px;
            margin: 20px 0;
            border: 1px solid var(--border-color);
            border-radius: 20px;
        }

        .settings-section h3 {
            margin-bottom: 16px;
            color: var(--text-primary);
            font-size: 1.2em;
            font-weight: 600;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .settings-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .settings-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .settings-card-header {
            background: var(--bg-tertiary);
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 1px solid var(--border-color);
        }

        .settings-card-header h3 {
            margin: 0;
            font-size: 1.1em;
            font-weight: 600;
            color: var(--text-primary);
        }

        .settings-icon {
            font-size: 1.5em;
        }

        .settings-card-body {
            padding: 20px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 8px 0;
        }

        .checkbox-label input[type="checkbox"] {
            width: auto;
            margin: 0;
            cursor: pointer;
        }

        .checkbox-label span {
            color: var(--text-primary);
        }

        .shortcut-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .shortcut-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: var(--bg-tertiary);
            border-radius: 8px;
        }

        .shortcut-key {
            background: var(--bg-primary);
            color: var(--text-primary);
            padding: 4px 12px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            border: 1px solid var(--border-color);
            font-size: 0.9em;
        }

        .shortcut-desc {
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        .achievement-preview {
            display: flex;
            gap: 12px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .achievement-badge {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: 12px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            border: 2px solid var(--border-color);
            min-width: 80px;
            transition: all 0.3s ease;
        }

        .achievement-badge.unlocked {
            border-color: #f9ca24;
            background: linear-gradient(135deg, #f9ca2420 0%, #ffa50220 100%);
        }

        .achievement-badge.locked {
            opacity: 0.5;
        }

        .achievement-badge span {
            font-size: 2em;
        }

        .achievement-badge small {
            font-size: 0.75em;
            color: var(--text-secondary);
            text-align: center;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .button-group .btn {
            flex: 1;
            min-width: 140px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #dee2e6;
            transition: .3s;
            border-radius: 26px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        input:checked + .slider {
            background: linear-gradient(135deg, #0f2027 0%, #2c5364 100%);
        }

        body.dark-mode input:checked + .slider {
            background: linear-gradient(135deg, #374151 0%, #4b5563 100%);
        }

        input:checked + .slider:before {
            transform: translateX(24px);
        }

        .deck-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .deck-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            padding: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 20px;
            box-shadow: var(--shadow-sm);
        }

        .deck-card:hover {
            border-color: #2c5364;
            background: var(--bg-tertiary);
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }

        .deck-title {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .deck-info {
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(4px);
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background-color: var(--bg-secondary);
            margin: 5% auto;
            padding: 32px;
            border: none;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-content h2 {
            font-size: 1.6em;
            font-weight: 600;
            margin-bottom: 24px;
            color: var(--text-primary);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 12px;
        }

        .close {
            color: var(--text-secondary);
            float: right;
            font-size: 28px;
            font-weight: 300;
            cursor: pointer;
            line-height: 20px;
            transition: color 0.2s;
        }

        .close:hover {
            color: var(--text-primary);
        }

        .progress-bar {
            width: 100%;
            height: 28px;
            background-color: var(--border-color);
            overflow: hidden;
            margin: 20px 0;
            border-radius: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #0f2027 0%, #2c5364 100%);
            transition: width 0.4s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.85em;
        }

        body.dark-mode .progress-fill {
            background: linear-gradient(90deg, #374151 0%, #4b5563 100%);
        }

        .breadcrumb {
            padding: 12px 0;
            font-size: 0.9em;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .breadcrumb a {
            color: #2c5364;
            text-decoration: none;
            cursor: pointer;
            transition: color 0.2s;
        }

        .breadcrumb a:hover {
            color: #0f2027;
            text-decoration: underline;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 3em;
            margin-bottom: 16px;
        }

        .empty-state h3 {
            font-weight: 500;
            color: var(--text-secondary);
        }

        .home-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }

        .home-stat-card {
            background: linear-gradient(135deg, #0f2027 0%, #2c5364 100%);
            color: white;
            padding: 24px;
            border-radius: 20px;
            box-shadow: 0 4px 12px rgba(15, 32, 39, 0.2);
            transition: transform 0.3s ease;
        }

        body.dark-mode .home-stat-card {
            background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
            border: 1px solid #30363d;
        }

        .home-stat-card:hover {
            transform: translateY(-3px);
        }

        .home-stat-value {
            font-size: 2.2em;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .home-stat-label {
            font-size: 0.85em;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .card-manage-item {
            display: flex;
            gap: 12px;
            align-items: center;
            padding: 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            margin-bottom: 10px;
            transition: all 0.2s ease;
            box-shadow: var(--shadow-sm);
        }

        .card-manage-item:hover {
            border-color: var(--border-color);
            box-shadow: var(--shadow-md);
        }

        .card-manage-content {
            flex: 1;
            font-size: 0.9em;
            color: var(--text-primary);
        }

        .card-manage-content div {
            margin: 6px 0;
            line-height: 1.5;
        }

        .chart-container {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 24px;
            margin: 20px 0;
        }

        .chart-title {
            font-size: 1.2em;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 20px;
        }

        .bar-chart {
            display: flex;
            align-items: flex-end;
            gap: 12px;
            height: 200px;
            padding: 10px 0;
        }

        .bar-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .bar {
            width: 100%;
            background: linear-gradient(180deg, #0f2027 0%, #2c5364 100%);
            border-radius: 8px 8px 0 0;
            transition: all 0.3s ease;
            position: relative;
            min-height: 5px;
        }

        body.dark-mode .bar {
            background: linear-gradient(180deg, #374151 0%, #4b5563 100%);
        }

        .bar:hover {
            opacity: 0.8;
        }

        .bar-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.85em;
            font-weight: 600;
            color: var(--text-primary);
        }

        .bar-label {
            font-size: 0.85em;
            color: var(--text-secondary);
            text-align: center;
        }

        .line-chart {
            height: 200px;
            display: flex;
            align-items: flex-end;
            gap: 4px;
            padding: 20px 0;
            position: relative;
        }

        .line-point {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .point {
            width: 12px;
            height: 12px;
            background: #0f2027;
            border-radius: 50%;
            position: relative;
            z-index: 2;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        body.dark-mode .point {
            background: #4b5563;
        }

        .point:hover {
            transform: scale(1.3);
        }

        @media (max-width: 768px) {
            .content {
                padding: 20px;
            }
            
            .header {
                padding: 24px 20px;
            }
            
            .nav {
                flex-direction: column;
            }
            
            .nav button {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #ddd;
            }
            
            .flashcard-container {
                margin: 20px auto;
            }
            
            .card-face {
                font-size: 1.1em;
                padding: 30px;
                height: 350px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>The Cube Professor</h1>
            <div class="nav">
                <button class="active" onclick="showView('library')">Home</button>
                <button onclick="showView('study')">Study Mode</button>
                <button onclick="showView('test')">Test Mode</button>
                <button onclick="showView('stats')">Statistics</button>
                <button onclick="showView('settings')">Settings</button>
            </div>
        </div>

        <div class="content">
            <!-- Library View -->
            <div id="library" class="view active">
                <h2>Home</h2>
                <div class="home-stats" id="homeStats"></div>
                <div class="breadcrumb" id="breadcrumb"></div>
                <div style="margin: 20px 0;">
                    <button class="btn" onclick="openModal('folderModal')">New Folder</button>
                    <button class="btn" onclick="openModal('deckModal')">New Deck</button>
                    <button class="btn btn-secondary" onclick="openModal('cardModal')">Add Card</button>
                </div>
                <div id="libraryContent" class="folder-tree"></div>
            </div>

            <!-- Study Mode View -->
            <div id="study" class="view">
                <h2>Study Mode</h2>
                <div id="studyContent">
                    <div class="empty-state">
                        <div class="empty-state-icon"></div>
                        <h3>Select a deck from your home to start studying</h3>
                        <button class="btn" onclick="showView('library')">Go to Home</button>
                    </div>
                </div>
            </div>

            <!-- Test Mode View -->
            <div id="test" class="view">
                <h2>Test Mode</h2>
                <div id="testContent">
                    <div class="empty-state">
                        <div class="empty-state-icon"></div>
                        <h3>Select a deck from your home to start testing</h3>
                        <button class="btn" onclick="showView('library')">Go to Home</button>
                    </div>
                </div>
            </div>

            <!-- Statistics View -->
            <div id="stats" class="view">
                <h2>Your Statistics</h2>
                <div id="statsContent"></div>
            </div>

            <!-- Settings View -->
            <div id="settings" class="view">
                <h2>Settings</h2>
                
                <div class="settings-grid">
                    <div class="settings-card">
                        <div class="settings-card-header">
                            <span class="settings-icon">üé®</span>
                            <h3>Appearance</h3>
                        </div>
                        <div class="settings-card-body">
                            <div class="form-group">
                                <label>Theme</label>
                                <select id="themeSetting" onchange="changeTheme()">
                                    <option value="light">Light Mode</option>
                                    <option value="dark">Dark Mode</option>
                                    <option value="auto">Auto (System)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="compactModeSetting">
                                    <span>Compact mode</span>
                                </label>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="animationsSetting" checked>
                                    <span>Enable animations</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="settings-card">
                        <div class="settings-card-header">
                            <span class="settings-icon">üìö</span>
                            <h3>Study Settings</h3>
                        </div>
                        <div class="settings-card-body">
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="autoFlipSetting">
                                    <span>Auto-flip cards after 3 seconds</span>
                                </label>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="shuffleSetting" checked>
                                    <span>Shuffle cards in study mode</span>
                                </label>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="soundSetting">
                                    <span>Enable sound effects</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="settings-card">
                        <div class="settings-card-header">
                            <span class="settings-icon">‚úçÔ∏è</span>
                            <h3>Test Settings</h3>
                        </div>
                        <div class="settings-card-body">
                            <div class="form-group">
                                <label>Test Mode</label>
                                <select id="testModeSetting">
                                    <option value="written">Written Response</option>
                                    <option value="multiple-choice">Multiple Choice</option>
                                    <option value="true-false">True/False</option>
                                    <option value="mixed">Mixed Mode</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Cards per test session</label>
                                <select id="testLimitSetting">
                                    <option value="10">10 cards</option>
                                    <option value="20" selected>20 cards</option>
                                    <option value="50">50 cards</option>
                                    <option value="all">All cards</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="showAnswerSetting">
                                    <span>Show answer immediately</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="settings-card">
                        <div class="settings-card-header">
                            <span class="settings-icon">‚å®Ô∏è</span>
                            <h3>Keyboard Shortcuts</h3>
                        </div>
                        <div class="settings-card-body">
                            <div class="shortcut-list">
                                <div class="shortcut-item">
                                    <span class="shortcut-key">Space</span>
                                    <span class="shortcut-desc">Flip card</span>
                                </div>
                                <div class="shortcut-item">
                                    <span class="shortcut-key">‚Üí</span>
                                    <span class="shortcut-desc">Next card</span>
                                </div>
                                <div class="shortcut-item">
                                    <span class="shortcut-key">‚Üê</span>
                                    <span class="shortcut-desc">Previous card</span>
                                </div>
                                <div class="shortcut-item">
                                    <span class="shortcut-key">1-4</span>
                                    <span class="shortcut-desc">Multiple choice</span>
                                </div>
                                <div class="shortcut-item">
                                    <span class="shortcut-key">Y / N</span>
                                    <span class="shortcut-desc">Correct/Incorrect</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="settings-card">
                        <div class="settings-card-header">
                            <span class="settings-icon">üèÜ</span>
                            <h3>Achievements</h3>
                        </div>
                        <div class="settings-card-body">
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="achievementsSetting" checked>
                                    <span>Enable achievements & streaks</span>
                                </label>
                            </div>
                            <div class="achievement-preview" id="achievementPreview">
                                <div class="achievement-badge locked">
                                    <span>üî•</span>
                                    <small>7 Day Streak</small>
                                </div>
                                <div class="achievement-badge locked">
                                    <span>üíØ</span>
                                    <small>Perfect Test</small>
                                </div>
                                <div class="achievement-badge locked">
                                    <span>üìö</span>
                                    <small>100 Cards</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="settings-card">
                        <div class="settings-card-header">
                            <span class="settings-icon">üíæ</span>
                            <h3>Data Management</h3>
                        </div>
                        <div class="settings-card-body">
                            <div class="button-group">
                                <button class="btn btn-secondary" onclick="exportData()">
                                    <span>üì•</span> Export Data
                                </button>
                                <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">
                                    <span>üì§</span> Import Data
                                </button>
                                <input type="file" id="importFile" style="display:none" onchange="importData(event)" accept=".json">
                            </div>
                            <button class="btn btn-danger" style="width: 100%; margin-top: 10px;" onclick="clearAllData()">
                                <span>üóëÔ∏è</span> Clear All Data
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Folder Modal -->
    <div id="folderModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('folderModal')">&times;</span>
            <h2>Create New Folder</h2>
            <div class="form-group">
                <label>Folder Name</label>
                <input type="text" id="folderName" placeholder="Enter folder name">
            </div>
            <div class="form-group">
                <label>Parent Folder</label>
                <select id="parentFolder">
                    <option value="">Root</option>
                </select>
            </div>
            <div class="form-group">
                <label>Folder Color</label>
                <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 8px;">
                    <label style="cursor: pointer;">
                        <input type="radio" name="folderColor" value="#0f2027" checked style="display: none;">
                        <div style="width: 40px; height: 40px; background: #0f2027; border-radius: 12px; border: 3px solid transparent;" class="color-option" data-color="#0f2027"></div>
                    </label>
                    <label style="cursor: pointer;">
                        <input type="radio" name="folderColor" value="#2c5364" style="display: none;">
                        <div style="width: 40px; height: 40px; background: #2c5364; border-radius: 12px; border: 3px solid transparent;" class="color-option" data-color="#2c5364"></div>
                    </label>
                    <label style="cursor: pointer;">
                        <input type="radio" name="folderColor" value="#134e5e" style="display: none;">
                        <div style="width: 40px; height: 40px; background: #134e5e; border-radius: 12px; border: 3px solid transparent;" class="color-option" data-color="#134e5e"></div>
                    </label>
                    <label style="cursor: pointer;">
                        <input type="radio" name="folderColor" value="#5f72bd" style="display: none;">
                        <div style="width: 40px; height: 40px; background: #5f72bd; border-radius: 12px; border: 3px solid transparent;" class="color-option" data-color="#5f72bd"></div>
                    </label>
                    <label style="cursor: pointer;">
                        <input type="radio" name="folderColor" value="#9921e8" style="display: none;">
                        <div style="width: 40px; height: 40px; background: #9921e8; border-radius: 12px; border: 3px solid transparent;" class="color-option" data-color="#9921e8"></div>
                    </label>
                    <label style="cursor: pointer;">
                        <input type="radio" name="folderColor" value="#e91e63" style="display: none;">
                        <div style="width: 40px; height: 40px; background: #e91e63; border-radius: 12px; border: 3px solid transparent;" class="color-option" data-color="#e91e63"></div>
                    </label>
                    <label style="cursor: pointer;">
                        <input type="radio" name="folderColor" value="#ff6b6b" style="display: none;">
                        <div style="width: 40px; height: 40px; background: #ff6b6b; border-radius: 12px; border: 3px solid transparent;" class="color-option" data-color="#ff6b6b"></div>
                    </label>
                    <label style="cursor: pointer;">
                        <input type="radio" name="folderColor" value="#ee5a24" style="display: none;">
                        <div style="width: 40px; height: 40px; background: #ee5a24; border-radius: 12px; border: 3px solid transparent;" class="color-option" data-color="#ee5a24"></div>
                    </label>
                    <label style="cursor: pointer;">
                        <input type="radio" name="folderColor" value="#ffa502" style="display: none;">
                        <div style="width: 40px; height: 40px; background: #ffa502; border-radius: 12px; border: 3px solid transparent;" class="color-option" data-color="#ffa502"></div>
                    </label>
                    <label style="cursor: pointer;">
                        <input type="radio" name="folderColor" value="#f9ca24" style="display: none;">
                        <div style="width: 40px; height: 40px; background: #f9ca24; border-radius: 12px; border: 3px solid transparent;" class="color-option" data-color="#f9ca24"></div>
                    </label>
                    <label style="cursor: pointer;">
                        <input type="radio" name="folderColor" value="#6ab04c" style="display: none;">
                        <div style="width: 40px; height: 40px; background: #6ab04c; border-radius: 12px; border: 3px solid transparent;" class="color-option" data-color="#6ab04c"></div>
                    </label>
                    <label style="cursor: pointer;">
                        <input type="radio" name="folderColor" value="#22a6b3" style="display: none;">
                        <div style="width: 40px; height: 40px; background: #22a6b3; border-radius: 12px; border: 3px solid transparent;" class="color-option" data-color="#22a6b3"></div>
                    </label>
                    <label style="cursor: pointer;">
                        <input type="radio" name="folderColor" value="#4facfe" style="display: none;">
                        <div style="width: 40px; height: 40px; background: #4facfe; border-radius: 12px; border: 3px solid transparent;" class="color-option" data-color="#4facfe"></div>
                    </label>
                    <label style="cursor: pointer;">
                        <input type="radio" name="folderColor" value="#43e97b" style="display: none;">
                        <div style="width: 40px; height: 40px; background: #43e97b; border-radius: 12px; border: 3px solid transparent;" class="color-option" data-color="#43e97b"></div>
                    </label>
                    <label style="cursor: pointer;">
                        <input type="radio" name="folderColor" value="#38f9d7" style="display: none;">
                        <div style="width: 40px; height: 40px; background: #38f9d7; border-radius: 12px; border: 3px solid transparent;" class="color-option" data-color="#38f9d7"></div>
                    </label>
                    <label style="cursor: pointer;">
                        <input type="radio" name="folderColor" value="#786fa6" style="display: none;">
                        <div style="width: 40px; height: 40px; background: #786fa6; border-radius: 12px; border: 3px solid transparent;" class="color-option" data-color="#786fa6"></div>
                    </label>
                </div>
            </div>
            <button class="btn" onclick="createFolder()">Create Folder</button>
        </div>
    </div>

    <!-- Deck Modal -->
    <div id="deckModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('deckModal')">&times;</span>
            <h2>Create New Deck</h2>
            <div class="form-group">
                <label>Deck Name</label>
                <input type="text" id="deckName" placeholder="Enter deck name">
            </div>
            <div class="form-group">
                <label>Folder</label>
                <select id="deckFolder">
                    <option value="">Root</option>
                </select>
            </div>
            <button class="btn" onclick="createDeck()">Create Deck</button>
        </div>
    </div>

    <!-- Card Modal -->
    <div id="cardModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('cardModal')">&times;</span>
            <h2>Add New Card</h2>
            <div class="form-group">
                <label>Select Deck</label>
                <select id="cardDeck"></select>
            </div>
            <div class="form-group">
                <label>Front (Question)</label>
                <textarea id="cardFront" placeholder="Enter question or term"></textarea>
            </div>
            <div class="form-group">
                <label>Back (Answer)</label>
                <textarea id="cardBack" placeholder="Enter answer or definition"></textarea>
            </div>
            <button class="btn" onclick="addCard()">Add Card</button>
        </div>
    </div>

    <!-- Manage Cards Modal -->
    <div id="manageCardsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('manageCardsModal')">&times;</span>
            <h2>Manage Cards</h2>
            <div id="manageCardsList" style="max-height: 400px; overflow-y: auto;"></div>
            <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #ddd;">
                <button class="btn btn-secondary" onclick="closeModal('manageCardsModal')">Close</button>
            </div>
        </div>
    </div>

    <script>
        // Data Structure
        let appData = {
            folders: [],
            decks: [],
            cards: [],
            stats: {
                totalStudySessions: 0,
                totalTestSessions: 0,
                totalCardsStudied: 0,
                correctAnswers: 0,
                incorrectAnswers: 0
            },
            settings: {
                autoFlip: false,
                shuffle: true,
                sound: false,
                showAnswer: false,
                testLimit: 20
            }
        };

        let currentPath = [];
        let currentDeck = null;
        let currentCardIndex = 0;
        let sessionCards = [];
        let testAnswers = [];

        // Initialize App
        function initApp() {
            loadData();
            renderLibrary();
            renderStats();
            loadSettings();
            updateFolderSelects();
            updateDeckSelects();
        }

        // Local Storage
        function saveData() {
            localStorage.setItem('flashcardApp', JSON.stringify(appData));
        }

        function loadData() {
            const saved = localStorage.getItem('flashcardApp');
            if (saved) {
                appData = JSON.parse(saved);
            } else {
                // Create sample data
                createSampleData();
            }
        }

        function createSampleData() {
            const mathFolder = { id: Date.now(), name: 'Mathematics', parent: null, color: '#0f2027' };
            appData.folders.push(mathFolder);
            
            const algebraFolder = { id: Date.now() + 1, name: 'Algebra', parent: mathFolder.id, color: '#2c5364' };
            appData.folders.push(algebraFolder);
            
            const deck1 = { id: Date.now() + 2, name: 'Basic Algebra', folder: algebraFolder.id, created: new Date().toISOString() };
            appData.decks.push(deck1);
            
            appData.cards.push(
                { id: Date.now() + 3, deck: deck1.id, front: 'What is the quadratic formula?', back: 'x = (-b ¬± ‚àö(b¬≤-4ac)) / 2a', correct: 0, incorrect: 0 },
                { id: Date.now() + 4, deck: deck1.id, front: 'Solve: 2x + 5 = 13', back: 'x = 4', correct: 0, incorrect: 0 },
                { id: Date.now() + 5, deck: deck1.id, front: 'What is a linear equation?', back: 'An equation of the first degree, forming a straight line when graphed', correct: 0, incorrect: 0 }
            );
            
            saveData();
        }

        // Navigation
        function showView(viewName) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav button').forEach(b => b.classList.remove('active'));
            
            document.getElementById(viewName).classList.add('active');
            event.target.classList.add('active');
            
            if (viewName === 'library') {
                renderLibrary();
            } else if (viewName === 'stats') {
                renderStats();
            }
        }

        // Library Functions
        function renderLibrary() {
            const container = document.getElementById('libraryContent');
            container.innerHTML = '';
            
            renderHomeStats();
            updateBreadcrumb();
            
            const currentFolderId = currentPath.length > 0 ? currentPath[currentPath.length - 1] : null;
            
            // Show folders
            const folders = appData.folders.filter(f => f.parent === currentFolderId);
            folders.forEach(folder => {
                const div = document.createElement('div');
                div.className = 'folder-item';
                const folderColor = folder.color || '#2193b0';
                div.innerHTML = `
                    <div class="folder-item-color" style="background: ${folderColor};" onclick="event.stopPropagation(); changeFolderColor(${folder.id})"></div>
                    <span class="folder-icon"></span>
                    <div class="folder-item-content"><strong>${folder.name}</strong></div>
                    <div class="folder-item-actions">
                        <button class="icon-btn delete" onclick="event.stopPropagation(); deleteFolder(${folder.id})">Delete</button>
                    </div>
                `;
                div.onclick = () => navigateToFolder(folder.id);
                container.appendChild(div);
            });
            
            // Show decks
            const decks = appData.decks.filter(d => d.folder === currentFolderId);
            decks.forEach(deck => {
                const cardCount = appData.cards.filter(c => c.deck === deck.id).length;
                const div = document.createElement('div');
                div.className = 'folder-item';
                div.innerHTML = `
                    <span class="deck-icon"></span>
                    <div class="folder-item-content" style="flex: 1;">
                        <strong>${deck.name}</strong>
                        <div class="deck-info">${cardCount} cards</div>
                    </div>
                    <div class="folder-item-actions">
                        <button class="icon-btn" onclick="event.stopPropagation(); manageDeckCards(${deck.id})">Manage Cards</button>
                        <button class="icon-btn delete" onclick="event.stopPropagation(); deleteDeck(${deck.id})">Delete</button>
                    </div>
                `;
                div.onclick = () => selectDeck(deck);
                container.appendChild(div);
            });
            
            if (folders.length === 0 && decks.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No folders or decks here. Create one to get started.</p></div>';
            }
        }

        function renderHomeStats() {
            const container = document.getElementById('homeStats');
            if (!container) return;
            
            const totalFolders = appData.folders.length;
            const totalDecks = appData.decks.length;
            const totalCards = appData.cards.length;
            const accuracy = (appData.stats.correctAnswers + appData.stats.incorrectAnswers) > 0 
                ? Math.round((appData.stats.correctAnswers / (appData.stats.correctAnswers + appData.stats.incorrectAnswers)) * 100) 
                : 0;
            
            container.innerHTML = `
                <div class="home-stat-card">
                    <div class="home-stat-value">${totalFolders}</div>
                    <div class="home-stat-label">Folders</div>
                </div>
                <div class="home-stat-card">
                    <div class="home-stat-value">${totalDecks}</div>
                    <div class="home-stat-label">Decks</div>
                </div>
                <div class="home-stat-card">
                    <div class="home-stat-value">${totalCards}</div>
                    <div class="home-stat-label">Cards</div>
                </div>
                <div class="home-stat-card">
                    <div class="home-stat-value">${accuracy}%</div>
                    <div class="home-stat-label">Accuracy</div>
                </div>
            `;
        }

        function navigateToFolder(folderId) {
            currentPath.push(folderId);
            renderLibrary();
        }

        function updateBreadcrumb() {
            const breadcrumb = document.getElementById('breadcrumb');
            let html = '<a onclick="navigateToRoot()">Home</a>';
            
            currentPath.forEach((folderId, index) => {
                const folder = appData.folders.find(f => f.id === folderId);
                if (folder) {
                    html += ` / <a onclick="navigateToBreadcrumb(${index})">${folder.name}</a>`;
                }
            });
            
            breadcrumb.innerHTML = html;
        }

        function navigateToRoot() {
            currentPath = [];
            renderLibrary();
        }

        function navigateToBreadcrumb(index) {
            currentPath = currentPath.slice(0, index + 1);
            renderLibrary();
        }

        function selectDeck(deck) {
            currentDeck = deck;
            const cards = appData.cards.filter(c => c.deck === deck.id);
            
            if (cards.length === 0) {
                alert('This deck has no cards yet. Add some cards first!');
                return;
            }
            
            // Show options
            const action = confirm('Click OK for Study Mode or Cancel for Test Mode');
            if (action) {
                startStudyMode(deck);
            } else {
                startTestMode(deck);
            }
        }

        // Study Mode
        function startStudyMode(deck) {
            showView('study');
            document.querySelector('.nav button:nth-child(2)').classList.add('active');
            
            currentDeck = deck;
            sessionCards = appData.cards.filter(c => c.deck === deck.id);
            
            if (appData.settings.shuffle) {
                sessionCards = shuffleArray(sessionCards);
            }
            
            currentCardIndex = 0;
            renderStudyCard();
            appData.stats.totalStudySessions++;
            saveData();
        }

        function renderStudyCard() {
            const container = document.getElementById('studyContent');
            
            if (currentCardIndex >= sessionCards.length) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>Study Session Complete</h3>
                        <p>You've reviewed all ${sessionCards.length} cards</p>
                        <button class="btn" onclick="startStudyMode(currentDeck)">Study Again</button>
                        <button class="btn btn-secondary" onclick="showView('library')">Back to Home</button>
                    </div>
                `;
                return;
            }
            
            const card = sessionCards[currentCardIndex];
            
            container.innerHTML = `
                <div class="card-counter">Card ${currentCardIndex + 1} of ${sessionCards.length}</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${(currentCardIndex / sessionCards.length) * 100}%">
                        ${Math.round((currentCardIndex / sessionCards.length) * 100)}%
                    </div>
                </div>
                <div class="flashcard-container">
                    <div class="flashcard" id="flashcard" onclick="flipCard()">
                        <div class="card-face card-front">
                            <div>${card.front}</div>
                        </div>
                        <div class="card-face card-back">
                            <div>${card.back}</div>
                        </div>
                    </div>
                </div>
                <div class="card-controls">
                    <button class="btn btn-secondary" onclick="previousCard()" ${currentCardIndex === 0 ? 'disabled' : ''}>‚Üê Previous</button>
                    <button class="btn" onclick="flipCard()">Flip Card</button>
                    <button class="btn btn-secondary" onclick="nextCard()">Next ‚Üí</button>
                </div>
            `;
            
            appData.stats.totalCardsStudied++;
            saveData();
        }

        function flipCard() {
            const flashcard = document.getElementById('flashcard');
            if (flashcard) {
                flashcard.classList.toggle('flipped');
            }
        }

        function nextCard() {
            currentCardIndex++;
            renderStudyCard();
        }

        function previousCard() {
            if (currentCardIndex > 0) {
                currentCardIndex--;
                renderStudyCard();
            }
        }

        // Test Mode
        function startTestMode(deck) {
            showView('test');
            document.querySelector('.nav button:nth-child(3)').classList.add('active');
            
            currentDeck = deck;
            let cards = appData.cards.filter(c => c.deck === deck.id);
            
            const limit = appData.settings.testLimit;
            if (limit !== 'all' && cards.length > parseInt(limit)) {
                cards = shuffleArray(cards).slice(0, parseInt(limit));
            } else {
                cards = shuffleArray(cards);
            }
            
            sessionCards = cards;
            currentCardIndex = 0;
            testAnswers = [];
            renderTestCard();
            appData.stats.totalTestSessions++;
            saveData();
        }

        function renderTestCard() {
            const container = document.getElementById('testContent');
            
            if (currentCardIndex >= sessionCards.length) {
                showTestResults();
                return;
            }
            
            const card = sessionCards[currentCardIndex];
            
            container.innerHTML = `
                <div class="card-counter">Question ${currentCardIndex + 1} of ${sessionCards.length}</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${(currentCardIndex / sessionCards.length) * 100}%">
                        ${Math.round((currentCardIndex / sessionCards.length) * 100)}%
                    </div>
                </div>
                <div class="flashcard-container">
                    <div class="card-face card-front" style="position: relative;">
                        <div>${card.front}</div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Your Answer</label>
                    <textarea id="testAnswer" placeholder="Type your answer here" style="width: 100%; max-width: 600px; margin: 20px auto; display: block;"></textarea>
                </div>
                <div id="answerFeedback"></div>
                <div class="card-controls">
                    <button class="btn" onclick="checkAnswer()">Check Answer</button>
                    <button class="btn btn-secondary" id="skipBtn" onclick="skipQuestion()">Skip</button>
                </div>
            `;
        }

        function checkAnswer() {
            const userAnswer = document.getElementById('testAnswer').value.trim();
            const card = sessionCards[currentCardIndex];
            const feedback = document.getElementById('answerFeedback');
            
            if (!userAnswer) {
                alert('Please enter an answer');
                return;
            }
            
            feedback.innerHTML = `
                <div style="background: #f8f9fa; padding: 28px; border: 2px solid #e9ecef; margin: 24px auto; max-width: 600px; border-radius: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
                    <h3 style="color: #2c3e50; margin-bottom: 16px;">Correct Answer:</h3>
                    <p style="font-size: 1.3em; margin: 20px 0; color: #495057; line-height: 1.6;">${card.back}</p>
                    <p style="margin-top: 24px; font-weight: 500; color: #6c757d;">Did you get it right?</p>
                    <div style="margin-top: 20px;">
                        <button class="btn btn-success" onclick="markCorrect()">Correct</button>
                        <button class="btn btn-danger" onclick="markIncorrect()">Incorrect</button>
                    </div>
                </div>
            `;
            
            testAnswers.push({ card: card, userAnswer: userAnswer, result: null });
            document.getElementById('skipBtn').style.display = 'none';
        }

        function markCorrect() {
            const card = sessionCards[currentCardIndex];
            testAnswers[testAnswers.length - 1].result = true;
            
            const cardData = appData.cards.find(c => c.id === card.id);
            cardData.correct++;
            appData.stats.correctAnswers++;
            saveData();
            
            currentCardIndex++;
            renderTestCard();
        }

        function markIncorrect() {
            const card = sessionCards[currentCardIndex];
            testAnswers[testAnswers.length - 1].result = false;
            
            const cardData = appData.cards.find(c => c.id === card.id);
            cardData.incorrect++;
            appData.stats.incorrectAnswers++;
            saveData();
            
            currentCardIndex++;
            renderTestCard();
        }

        function skipQuestion() {
            currentCardIndex++;
            renderTestCard();
        }

        function showTestResults() {
            const container = document.getElementById('testContent');
            const correct = testAnswers.filter(a => a.result === true).length;
            const incorrect = testAnswers.filter(a => a.result === false).length;
            const total = testAnswers.length;
            const percentage = total > 0 ? Math.round((correct / total) * 100) : 0;
            
            let grade = '';
            if (percentage >= 90) grade = 'A';
            else if (percentage >= 80) grade = 'B';
            else if (percentage >= 70) grade = 'C';
            else if (percentage >= 60) grade = 'D';
            else grade = 'F';
            
            container.innerHTML = `
                <div style="text-align: center; padding: 50px 20px;">
                    <h2 style="color: #2c3e50; font-size: 2em; margin-bottom: 16px;">Test Complete</h2>
                    <div class="stat-value" style="background: linear-gradient(135deg, #0f2027 0%, #2c5364 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin: 30px 0; font-size: 4em;">${percentage}%</div>
                    <h3 style="color: #495057; font-weight: 500; font-size: 1.5em;">Grade: ${grade}</h3>
                    <div class="stats-grid" style="margin-top: 50px;">
                        <div class="stat-card" style="background: linear-gradient(135deg, #06d6a0 0%, #1b998b 100%);">
                            <div class="stat-value">${correct}</div>
                            <div class="stat-label">Correct</div>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, #ef476f 0%, #e74c3c 100%);">
                            <div class="stat-value">${incorrect}</div>
                            <div class="stat-label">Incorrect</div>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, #0f2027 0%, #2c5364 100%);">
                            <div class="stat-value">${total}</div>
                            <div class="stat-label">Total Answered</div>
                        </div>
                    </div>
                    <div style="margin-top: 50px;">
                        <button class="btn" onclick="startTestMode(currentDeck)">Take Test Again</button>
                        <button class="btn btn-secondary" onclick="showView('library')">Back to Home</button>
                        <button class="btn btn-secondary" onclick="showView('stats')">View All Stats</button>
                    </div>
                </div>
            `;
        }

        // Statistics
        function renderStats() {
            const container = document.getElementById('statsContent');
            const accuracy = (appData.stats.correctAnswers + appData.stats.incorrectAnswers) > 0 
                ? Math.round((appData.stats.correctAnswers / (appData.stats.correctAnswers + appData.stats.incorrectAnswers)) * 100) 
                : 0;
            
            container.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Study Sessions</div>
                        <div class="stat-value">${appData.stats.totalStudySessions}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Test Sessions</div>
                        <div class="stat-value">${appData.stats.totalTestSessions}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Cards Studied</div>
                        <div class="stat-value">${appData.stats.totalCardsStudied}</div>
                    </div>
                    <div class="stat-card" style="background: #28a745;">
                        <div class="stat-label">Accuracy</div>
                        <div class="stat-value">${accuracy}%</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                        <div class="stat-label">Correct Answers</div>
                        <div class="stat-value">${appData.stats.correctAnswers}</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);">
                        <div class="stat-label">Incorrect Answers</div>
                        <div class="stat-value">${appData.stats.incorrectAnswers}</div>
                    </div>
                </div>
                
                <h3 style="margin-top: 40px;">Deck Performance</h3>
                <div id="deckStats" style="margin-top: 20px;"></div>
            `;
            
            renderDeckStats();
        }

        function renderDeckStats() {
            const container = document.getElementById('deckStats');
            if (!container) return;
            
            let html = '';
            appData.decks.forEach(deck => {
                const cards = appData.cards.filter(c => c.deck === deck.id);
                const totalAttempts = cards.reduce((sum, c) => sum + c.correct + c.incorrect, 0);
                const correct = cards.reduce((sum, c) => sum + c.correct, 0);
                const accuracy = totalAttempts > 0 ? Math.round((correct / totalAttempts) * 100) : 0;
                
                html += `
                    <div class="deck-card">
                        <div class="deck-title">${deck.name}</div>
                        <div class="deck-info">
                            ${cards.length} cards | ${totalAttempts} attempts | ${accuracy}% accuracy
                        </div>
                        <div class="progress-bar" style="margin-top: 10px;">
                            <div class="progress-fill" style="width: ${accuracy}%">${accuracy}%</div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html || '<p>No deck statistics yet. Start studying to see your progress!</p>';
        }

        // Settings
        function loadSettings() {
            document.getElementById('autoFlipSetting').checked = appData.settings.autoFlip;
            document.getElementById('shuffleSetting').checked = appData.settings.shuffle;
            document.getElementById('soundSetting').checked = appData.settings.sound;
            document.getElementById('showAnswerSetting').checked = appData.settings.showAnswer;
            document.getElementById('testLimitSetting').value = appData.settings.testLimit;
            
            // Load appearance settings
            if (appData.settings.theme) {
                document.getElementById('themeSetting').value = appData.settings.theme;
                applyTheme(appData.settings.theme);
            }
            if (appData.settings.compactMode) {
                document.getElementById('compactModeSetting').checked = appData.settings.compactMode;
            }
            if (appData.settings.animations !== undefined) {
                document.getElementById('animationsSetting').checked = appData.settings.animations;
            }
            
            document.getElementById('autoFlipSetting').onchange = () => {
                appData.settings.autoFlip = document.getElementById('autoFlipSetting').checked;
                saveData();
            };
            
            document.getElementById('shuffleSetting').onchange = () => {
                appData.settings.shuffle = document.getElementById('shuffleSetting').checked;
                saveData();
            };
            
            document.getElementById('soundSetting').onchange = () => {
                appData.settings.sound = document.getElementById('soundSetting').checked;
                saveData();
            };
            
            document.getElementById('showAnswerSetting').onchange = () => {
                appData.settings.showAnswer = document.getElementById('showAnswerSetting').checked;
                saveData();
            };
            
            document.getElementById('testLimitSetting').onchange = () => {
                appData.settings.testLimit = document.getElementById('testLimitSetting').value;
                saveData();
            };
            
            document.getElementById('compactModeSetting').onchange = () => {
                appData.settings.compactMode = document.getElementById('compactModeSetting').checked;
                saveData();
            };
            
            document.getElementById('animationsSetting').onchange = () => {
                appData.settings.animations = document.getElementById('animationsSetting').checked;
                document.body.style.setProperty('--transition-speed', appData.settings.animations ? '0.3s' : '0s');
                saveData();
            };
        }

        function changeTheme() {
            const theme = document.getElementById('themeSetting').value;
            appData.settings.theme = theme;
            saveData();
            applyTheme(theme);
        }

        function applyTheme(theme) {
            if (theme === 'dark') {
                document.body.classList.add('dark-mode');
            } else if (theme === 'light') {
                document.body.classList.remove('dark-mode');
            } else if (theme === 'auto') {
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                if (prefersDark) {
                    document.body.classList.add('dark-mode');
                } else {
                    document.body.classList.remove('dark-mode');
                }
            }
        }

        // CRUD Operations
        function createFolder() {
            const name = document.getElementById('folderName').value.trim();
            const parent = document.getElementById('parentFolder').value || null;
            const colorInput = document.querySelector('input[name="folderColor"]:checked');
            const color = colorInput ? colorInput.value : '#0f2027';
            
            if (!name) {
                alert('Please enter a folder name');
                return;
            }
            
            appData.folders.push({
                id: Date.now(),
                name: name,
                parent: parent ? parseInt(parent) : null,
                color: color
            });
            
            saveData();
            closeModal('folderModal');
            updateFolderSelects();
            renderLibrary();
            document.getElementById('folderName').value = '';
        }

        function changeFolderColor(folderId) {
            const folder = appData.folders.find(f => f.id === folderId);
            if (!folder) return;
            
            const colors = ['#0f2027', '#2c5364', '#134e5e', '#5f72bd', '#9921e8', '#e91e63', '#ff6b6b', '#ee5a24', '#ffa502', '#f9ca24', '#6ab04c', '#22a6b3', '#4facfe', '#43e97b', '#38f9d7', '#786fa6'];
            const currentIndex = colors.indexOf(folder.color || '#0f2027');
            const nextIndex = (currentIndex + 1) % colors.length;
            
            folder.color = colors[nextIndex];
            saveData();
            renderLibrary();
        }

        function createDeck() {
            const name = document.getElementById('deckName').value.trim();
            const folder = document.getElementById('deckFolder').value || null;
            
            if (!name) {
                alert('Please enter a deck name');
                return;
            }
            
            appData.decks.push({
                id: Date.now(),
                name: name,
                folder: folder ? parseInt(folder) : null,
                created: new Date().toISOString()
            });
            
            saveData();
            closeModal('deckModal');
            updateDeckSelects();
            renderLibrary();
            document.getElementById('deckName').value = '';
        }

        function addCard() {
            const deckId = parseInt(document.getElementById('cardDeck').value);
            const front = document.getElementById('cardFront').value.trim();
            const back = document.getElementById('cardBack').value.trim();
            
            if (!deckId || !front || !back) {
                alert('Please fill in all fields');
                return;
            }
            
            appData.cards.push({
                id: Date.now(),
                deck: deckId,
                front: front,
                back: back,
                correct: 0,
                incorrect: 0
            });
            
            saveData();
            closeModal('cardModal');
            document.getElementById('cardFront').value = '';
            document.getElementById('cardBack').value = '';
            alert('Card added successfully!');
        }

        // Modal Functions
        function openModal(modalId) {
            if (modalId === 'cardModal' && appData.decks.length === 0) {
                alert('Please create a deck first!');
                return;
            }
            
            // Auto-select current folder when opening folder or deck modal
            if (modalId === 'folderModal' || modalId === 'deckModal') {
                updateFolderSelects();
                const currentFolderId = currentPath.length > 0 ? currentPath[currentPath.length - 1] : '';
                
                if (modalId === 'folderModal') {
                    document.getElementById('parentFolder').value = currentFolderId;
                } else if (modalId === 'deckModal') {
                    document.getElementById('deckFolder').value = currentFolderId;
                }
            }
            
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Update Select Dropdowns
        function updateFolderSelects() {
            const selects = ['parentFolder', 'deckFolder'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (!select) return;
                
                const currentValue = select.value;
                select.innerHTML = '<option value="">Root</option>';
                
                function addFolderOptions(parentId, prefix = '') {
                    const folders = appData.folders.filter(f => f.parent === parentId);
                    folders.forEach(folder => {
                        const option = document.createElement('option');
                        option.value = folder.id;
                        option.textContent = prefix + folder.name;
                        select.appendChild(option);
                        addFolderOptions(folder.id, prefix + '  ');
                    });
                }
                
                addFolderOptions(null);
                
                // Restore the previous value if it still exists
                if (currentValue) {
                    select.value = currentValue;
                }
            });
        }

        function updateDeckSelects() {
            const select = document.getElementById('cardDeck');
            select.innerHTML = '';
            
            appData.decks.forEach(deck => {
                const option = document.createElement('option');
                option.value = deck.id;
                option.textContent = deck.name;
                select.appendChild(option);
            });
        }

        // Utility Functions
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // Data Management
        function exportData() {
            const dataStr = JSON.stringify(appData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `flashcards_backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    if (confirm('This will replace all current data. Continue?')) {
                        appData = imported;
                        saveData();
                        initApp();
                        alert('Data imported successfully!');
                    }
                } catch (error) {
                    alert('Error importing data. Please check the file format.');
                }
            };
            reader.readAsText(file);
        }

        function deleteFolder(folderId) {
            if (!confirm('Delete this folder? All subfolders and decks inside will also be deleted.')) {
                return;
            }
            
            // Find all subfolders recursively
            function getAllSubfolders(parentId) {
                const subfolders = appData.folders.filter(f => f.parent === parentId);
                let allIds = subfolders.map(f => f.id);
                subfolders.forEach(f => {
                    allIds = allIds.concat(getAllSubfolders(f.id));
                });
                return allIds;
            }
            
            const folderIds = [folderId, ...getAllSubfolders(folderId)];
            
            // Delete all decks in these folders
            folderIds.forEach(id => {
                const decksToDelete = appData.decks.filter(d => d.folder === id);
                decksToDelete.forEach(deck => {
                    // Delete all cards in deck
                    appData.cards = appData.cards.filter(c => c.deck !== deck.id);
                    // Delete deck
                    appData.decks = appData.decks.filter(d => d.id !== deck.id);
                });
            });
            
            // Delete all folders
            appData.folders = appData.folders.filter(f => !folderIds.includes(f.id));
            
            saveData();
            renderLibrary();
            updateFolderSelects();
            updateDeckSelects();
        }

        function deleteDeck(deckId) {
            const deck = appData.decks.find(d => d.id === deckId);
            const cardCount = appData.cards.filter(c => c.deck === deckId).length;
            
            if (!confirm(`Delete "${deck.name}" and all ${cardCount} cards inside?`)) {
                return;
            }
            
            appData.cards = appData.cards.filter(c => c.deck !== deckId);
            appData.decks = appData.decks.filter(d => d.id !== deckId);
            
            saveData();
            renderLibrary();
            updateDeckSelects();
        }

        function manageDeckCards(deckId) {
            currentDeck = appData.decks.find(d => d.id === deckId);
            const cards = appData.cards.filter(c => c.deck === deckId);
            
            const modal = document.getElementById('manageCardsModal');
            const container = document.getElementById('manageCardsList');
            
            container.innerHTML = '';
            
            if (cards.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">No cards in this deck yet.</p>';
            } else {
                cards.forEach(card => {
                    const div = document.createElement('div');
                    div.className = 'card-manage-item';
                    div.innerHTML = `
                        <div class="card-manage-content">
                            <div><strong>Q:</strong> ${card.front}</div>
                            <div><strong>A:</strong> ${card.back}</div>
                        </div>
                        <button class="btn btn-danger btn-small" onclick="deleteCard(${card.id})">Delete</button>
                    `;
                    container.appendChild(div);
                });
            }
            
            openModal('manageCardsModal');
        }

        function deleteCard(cardId) {
            if (!confirm('Delete this card?')) {
                return;
            }
            
            appData.cards = appData.cards.filter(c => c.id !== cardId);
            saveData();
            
            // Refresh the manage cards view
            if (currentDeck) {
                manageDeckCards(currentDeck.id);
            }
            renderLibrary();
        }

        function clearAllData() {
            if (confirm('This will delete ALL your data. Are you sure?')) {
                if (confirm('This action cannot be undone. Really delete everything?')) {
                    localStorage.removeItem('flashcardApp');
                    appData = {
                        folders: [],
                        decks: [],
                        cards: [],
                        stats: {
                            totalStudySessions: 0,
                            totalTestSessions: 0,
                            totalCardsStudied: 0,
                            correctAnswers: 0,
                            incorrectAnswers: 0
                        },
                        settings: {
                            autoFlip: false,
                            shuffle: true,
                            sound: false,
                            showAnswer: false,
                            testLimit: 20,
                            theme: 'light',
                            compactMode: false,
                            animations: true
                        }
                    };
                    saveData();
                    initApp();
                    alert('All data cleared!');
                }
            }
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        // Handle color option selection
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('color-option')) {
                // Remove active class from all color options
                document.querySelectorAll('.color-option').forEach(opt => {
                    opt.style.border = '3px solid transparent';
                });
                // Add active class to clicked option
                e.target.style.border = '3px solid #2c3e50';
                // Check the associated radio button
                const radio = e.target.parentElement.querySelector('input[type="radio"]');
                if (radio) radio.checked = true;
            }
        });

        // Initialize on load
        window.onload = initApp;
    </script>
</body>
</html>
